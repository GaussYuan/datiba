<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="home/public/head::head(~{::title},~{::style},~{})">
    <title>有问有答-答题吧</title>
    <style>
        .label {
            color: #746F6F;
        }

        .label-info {
            color: #FFFFFF;
        }
        [v-cloak]{
            display: none;
        }
    </style>
</head>

<body>

<!--顶部导航栏-->
<div th:replace="home/public/top-menu::top-menu"></div>
<div id="question_container" v-cloak>
<nav class="navbar navbar-default ex-navbar">
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <form class="navbar-form navbar-left form-inline" style="text-align: center;width: 100%;">
            <div class="form-group">
                <select class="form-control" v-model="searchGradeId">
                    <option selected value="">所有年级</option>
                    <option v-for="item in gradeList" :value="item.id">{{item.gradeName}}</option>
                </select>
            </div>
            <div class="form-group">
                <select class="form-control" v-model="searchSubjectId">
                    <option selected value="">所有学科</option>
                    <option v-for="item in subjectList" :value="item.id">{{item.subjectName}}</option>
                </select>
            </div>
            <div class="form-group">
                <input type="text" v-model="questionSummary" class="form-control" placeholder="题目内容...">
            </div>
            <button type="button" @click="searchBtn()" class="btn btn-default">搜索</button>
        </form>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-md-12 col-xs-10">
            <ul id="myTab" class="nav nav-tabs">
                <li class="active">
                    <a href="#home" data-toggle="tab" @click="changeIntegral('false')">
                        全部问题
                    </a>
                </li>
                <li><a href="#needintegral" @click="changeIntegral('true')" data-toggle="tab">积分悬赏</a></li>
            </ul>

            <div class="tab-content" style="padding: 20px;">
                <div class="tab-pane fade in active">
                    <p>
                        <strong>年级：</strong>
                        <span class="label" :class="{'label-info':gradeId==''}" @click="changeGradeId('')">全部</span>
                        <span v-for="item in gradeList"
                              @click="changeGradeId(item.id)"
                              class="label"
                              :class="{'label-info':gradeId==item.id}">{{item.gradeName}}</span>
                    </p>
                    <p>
                        <strong>学科：</strong>
                        <span class="label" :class="{'label-info':subjectId==''}" @click="changeSubjectId('')">全部</span>
                        <span v-for="item in subjectList"
                              @click="changeSubjectId(item.id)"
                              class="label"
                              :class="{'label-info':subjectId==item.id}">{{item.subjectName}}</span>
                    </p>
                </div>
            </div>

            <div id="myTabContent" class="tab-content" style="padding: 20px;">
                <div class="tab-pane fade in active" id="home">
                    <div class="row" v-for="item in questionList" style="border-bottom: #D0C8C8 1px solid;margin-top: 15px;">
                        <div class="col-md-2">
                            <a href="#">
                                <img :src="item.user.userPhoto" style="width: 100%;" class="img-rounded" />
                                <p class="text-center">{{item.user.nickName}}</p>
                            </a>
                        </div>

                        <div class="col-md-10">
                            <div class="row">
                                <div class="col-md-12">
                                    <p class="text-left">
                                        {{item.questionSummary}}
                                    </p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="col-md-3 text-success">[{{item.grade.gradeName}}{{item.subject.subjectName}}]</div>
                                    <div class="col-md-9 text-muted">{{item.createTime}}</div>
                                </div>

                                <div class="col-md-6 text-right">
                                    <div class="col-md-8 text-primary">悬赏积分：{{item.integral}}分</div>
                                    <a :href="'/home/question/getAnswerList?questionId='+item.id" class="col-md-4 text-primary">回答：（{{item.count}}）</a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
            <ul class="pagination">
                <li :class="{'disabled':pageNum<=1}" @click="changePage(pageNum-1)"><a href="#">&laquo;</a></li>
                <li :class="{'disabled':pageNum==item}" v-for="(item,index) in pages" @click="changePage(item)"><a href="#">{{item}}</a></li>
                <li :class="{'disabled':pageNum>=pages}" @click="changePage(pageNum+1)"><a href="#">&raquo;</a></li>
            </ul>
            <div id="page" class="col-md-8 col-md-offset-2"></div>
        </div>
    </div>
</div>
</div>

<!-- 底部导航栏 start-->
<footer th:replace="home/public/footer::footer"></footer>
<!-- 底部导航栏end -->

<script th:src="@{/static/home/plugs/vue/vue.js}"></script>

<!--vue相关js-->
<script th:inline="javascript">

    var layer,form;
    layui.use(['laypage','layer', 'form'], function(){
        laypage = layui.laypage
            ,layer = layui.layer
            ,form = layui.form;
    });

    var app = new Vue({
        el:"#question_container",
        data:{
            subjectList:"",//学科信息
            gradeList:"",//年级信息
            questionList:"",//问题列表
            needIntegral:false,//是否需要积分
            questionSummary:null,//搜索内容
            gradeId:"",//当前年级id，默认空，为全部
            searchGradeId:"",//搜索时的年级id，默认全部年级
            searchSubjectId:"",//搜索时的学科id，默认全部学科
            subjectId:"",//当前学科id，默认空，为全部
            pageNum:1,//当前页码，默认为1
            pageSize:10,//每页显示条数，默认显示10条数据
            pages:0,//总页数
            total:0,//结果总数
            tp:"all"

        },
        methods:{
            /**
             * 获取年级列表
             */
            getGradeList:function(){
                $.get("/home/subject/getSubjectList",function (res) {
                    app.$data.subjectList = res.data;
                    console.log("subjectList:",res.data);
                })
            },
            /**
             * 获取学科列表
             */
            getSubjectList:function () {
                $.get("/home/grade/getGradeList",function (res) {
                    app.$data.gradeList = res.data;
                    console.log("gradeList:",res.data);
                })
            },
            /**
             * 获取问题列表
             */
            getQuestionList:function(){
                if (app.$data.tp=="search"){
                    app.$data.gradeId = app.$data.searchGradeId;
                    app.$data.subjectId = app.$data.searchSubjectId;
                }
                var requestData = {
                    gradeId:app.$data.gradeId,
                    subjectId:app.$data.subjectId,
                    needIntegral:app.$data.needIntegral,
                    pageNum:app.$data.pageNum,
                    pageSize:app.$data.pageSize,
                    questionSummary:app.$data.questionSummary
                };

                console.log("请求问题列表参数：",requestData);
                $.post("/home/question/getQuestionList",requestData,function (res) {
                    console.log("获取到的问题列表数据：",res.data);
                    app.$data.questionList = res.data.list;
                    app.$data.total = res.data.pageInfo.total;
                    app.$data.pages = res.data.pageInfo.pages;
                });
                app.$data.tp="all";
            },
            /**
             * 修改当前查看的者年级的id值
             * @param id
             */
            changeGradeId:function (id) {
                app.$data.gradeId = id;
                console.log("改变后的id：",app.$data.gradeId);
                this.getQuestionList();
            },
            /**
             * 修改当前查看的者年级的id值
             * @param id
             */
            changeSubjectId:function (id) {
                app.$data.subjectId = id;
                console.log("改变后的id：",app.$data.subjectId);
                this.getQuestionList();
            },
            /**
             * 是否需要积分true or false
             * @param d
             */
            changeIntegral:function (d) {
                app.$data.needIntegral = d;
                this.getQuestionList();
            },
            /**
             * 通过按钮搜索
             */
            searchBtn:function () {
                app.$data.tp = "search";
                app.getQuestionList();
            },
            changePage:function (totalPage) {
                if (totalPage>0 || totalPage<app.$data.pages){
                    app.$data.pageNum=totalPage;
                    app.getQuestionList();
                }
            }
        }
    });
    //首次加载获取数据
    app.getSubjectList();//获取学科列表
    app.getGradeList();//获取年级列表
    app.getQuestionList();//获取问题列表



</script>
</body>
</html>
